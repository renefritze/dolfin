# Copyright (C) 2010 Anders Logg and Kristian Oelgaard
#
# This file is part of DOLFIN.
#
# DOLFIN is free software: you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# DOLFIN is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License
# along with DOLFIN. If not, see <http://www.gnu.org/licenses/>.
#
# Modified by Marie E. Rognes
#
# First added:  2010
# Last changed: 2011-05-23

__all__ = ["generate_dolfin_doc"]

import os, time

from generatecpprst import generate_cpp_api_documentation
from generatepythonrst import generate_python_api_documentation

def generate_dolfin_doc(input_dir, output_dir, version=None):

    if version is None:
        version = "dev"

    # Make output directory (or use current if existing)
    try:
        os.makedirs(output_dir)
    except:
        pass

    # Generate .rst for C++ documentation
    api_output_dir = os.path.join(output_dir, "cpp", "programmers-reference")
    generate_cpp_api_documentation(input_dir, api_output_dir, version)

    # Generate .rst for Python documentation
    api_output_dir = os.path.join(output_dir, "python", "programmers-reference")
    generate_python_api_documentation(api_output_dir, version)

if __name__ == "__main__":

    # Set output directory: everything else will be generated relative
    # to this directory. (Tune at will)
    here = os.path.dirname(os.path.abspath(__file__))
    output_dir = os.path.join(here, "tmp", "doc")

    # Use main dolfin directory as input directory
    pardir = os.path.pardir
    input_dir = os.path.join(here, pardir, pardir, pardir)

    # Generate complete dolfin documentation
    print "Generating documentation in %s" % output_dir
    start = time.time()
    generate_dolfin_doc(input_dir, output_dir, version="0.9.11+")
    stop = time.time()
    print "Generating documentation took %0.1f s" % (stop - start)


